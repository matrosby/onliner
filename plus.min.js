window.__sbg_plus_version="0.96";(function(){const e=["home","allLines","builder","undo","clear","route","copy","paste","help"];class Label{constructor(e){this.values=e}toString(){return this.values[window.__sbg_language]}}const t={ymaps:new Label({ru:"Яндекс Карты",en:"Yandex Maps"}),settings:{title:new Label({ru:"Настройки скриптов",en:"Scripts settings"}),button:new Label({ru:"Настройки",en:"Settings"}),version:new Label({ru:"Версия SBG+",en:"SBG+ Version"}),logs:new Label({ru:"Скопировать логи",en:"Copy logs"})},toasts:{back:new Label({ru:'Нажмите кнопку "Назад" ещё раз\nдля выхода из игры',en:'Press "Back" button again to exit the game'}),logs:new Label({ru:"Логи скопированы в буфер обмена",en:"Logs has been copied into the clipboard"})},builder:{buttons:{home:{title:new Label({ru:"Я здесь",en:"Set home"}),description:new Label({ru:'устанавливает "домашнее местоположение", с которого игра всегда будет открываться в этом браузере',en:'sets "home location", which game will always start with in this browser'})},allLines:{title:new Label({ru:"Все линии",en:"All lines"}),description:new Label({ru:"включает/отключает показ реально существующих линий и регионов",en:"toggles currently existing lines and regions"})},builder:{title:new Label({ru:"Конструктор",en:"Builder"}),description:new Label({ru:"включает/отключает режим конструктора: нажатие на точку начинает новую линию, нажатие на другую точку - заканчивает линию",en:"toggles builder mode: click first point to start new line, click another point to finish the line"})},undo:{title:new Label({ru:"Отменить",en:"Undo"}),description:new Label({ru:"стирает последнюю построенную линию/регион",en:"removes last built line/region"})},clear:{title:new Label({ru:"Отменить всё",en:"Clear"}),description:new Label({ru:"стирает все построенные линии и регионы",en:"removes all build lines and regions"})},route:{title:new Label({ru:"Маршрут",en:"Print route"}),description:new Label({ru:"показывает все построенные линии, в виде списка в порядке постройки",en:"shows all built lines as a list in the order of building"})},copy:{title:new Label({ru:"Копировать",en:"Copy"}),description:new Label({ru:"(Ctrl-C) копирует все построенные линии в буфер обмена",en:"(Ctrl-C) copies all built lines into the clipboard"})},paste:{title:new Label({ru:"Вставить",en:"Paste"}),description:new Label({ru:"(Ctrl-V) вставляет ранее построенные линии из буфера обмена",en:"(Ctrl-V) pastes previously built lines from the clipboard"})},help:{title:new Label({ru:"Помощь",en:"Help"}),description:new Label({ru:"показывает инструкции",en:"shows instructions"})}},messages:{setHome:new Label({ru:"Всегда открывать SBG на текущем местоположении?",en:"Always open SBG using currently opened location?"}),deleteHome:new Label({ru:'Забыть "домашнее местоположение" SBG?',en:'Forget "home location"?'}),copied:new Label({ru:"Данные скопированы в буфер обмена",en:"Data has been copied into the clipboard"})},issues:{title:new Label({ru:"Известные ограничения и проблемы",en:"Known limitations and problems"}),list:[new Label({ru:"Не всегда рисуется линия, потому что если при нажатии мышкой сдвинуть карту хоть на миллиметр - карта думает, что её двигают, а не кликают, и никак не реагирует",en:"Lines are not always being drawn, because clicking mouse button when moving map even one pixel ahead will make the map treat this click as a moving action and do not react as expected"}),new Label({ru:"Если два раза нажать на точку - она остаётся оранжевой, даже если закончить линию",en:"Point leaves orange when clicking twice, even when line has been finished"}),new Label({ru:"Если нажать на точку, а потом подвинуть карту - она перестаёт быть оранжевой",en:"Orange point stops to be orange if move map"})]},help:{title:new Label({ru:"Конструктор",en:"Builder"}),buttons:new Label({ru:"Кнопки",en:"Buttons"})},validationErrors:{json:new Label({ru:"Текст должен быть валидным JSON-объектом",en:"Text should be a valid JSON object"}),empty:new Label({ru:"Ничего нет",en:"Nothing found"}),object:new Label({ru:"Данные должны быть объектом",en:"Data should be an object"}),objectProperties:new Label({ru:"Объект с данными должен содержать два объекта: 'points' и 'lines'",en:"Data object should contain two objects: 'points' and 'lines'"}),pointProperties:new Label({ru:"Каждый объект в 'points' должен содержать поля: 'guid' (string), 'title' (string) и 'coords' (object)",en:"Each object in 'points' should contain properties: 'guid' (string), 'title' (string) and 'coords' (object)"}),pointCoords:new Label({ru:"Каждый объект в 'points' должен содержать массив 'coords', из двух координат типа (number)",en:"Each object in 'points' should contain array 'coords' of two coordinates of type (number)"}),lines:new Label({ru:"Массив 'lines' должен состоять из массивов координат линий",en:"Array 'lines' should contain arrays of line coordinates"}),linesCoords:new Label({ru:"Каждый массив в 'lines' должен состоять из двух массивов координат точек",en:"Each array in 'lines' should contain two arrays of point coordinates"})}}};const n={scripts:{ru:"Скрипты",en:"Scripts"},common:{ru:"Общие настройки",en:"Common settings"},cui:{ru:"Скрипт Николая",en:"Nicko script"},eui:{ru:"Скрипт Егора",en:"Egor script"},windows:{ru:"Окна",en:"Windows"},animations:{ru:"Анимации",en:"Animations"},toolbar:{ru:"Боковая панель",en:"Toolbar"},fire:{ru:"Атака",en:"Fire"},inventory:{ru:"Инвентарь",en:"Inventory"},leaderboard:{ru:"Лидеры",en:"Leaderboard"},info:{ru:"Информация о точке",en:"Point info"},draw:{ru:"Рисование",en:"Draw"},other:{ru:"Прочие настройки",en:"Other settings"},custom:{ru:"Мои настройки",en:"My settings"}};class FeatureBase{constructor(e,t,n){this.key=e.name;this.label=new Label(t);this.group=n.group;this.trigger=n.trigger;this.desktop=n.desktop;this.default=n.default}setEnabled(e){r.setFeature(this.key,e)}isEnabled(){var e;return(e=r.getFeature(this.key))!==null&&e!==void 0?e:this.isAvailable()&&this.isIncluded(window.__sbg_preset)&&this.default}isAvailable(){if(!isMobile()&&!this.desktop){return false}return window.__sbg_preset==="full"||this.isIncluded(localStorage["sbg-plus-test-mode"]?"full":"public")}isIncluded(e){const t=o[e]||o["default"];if(t.enabled){return t.enabled.includes(this.func)}if(t.disabled){return!t.disabled.includes(this.func)}return true}exec(e){if(!this.isEnabled()){log(`skipped ${this.func.name}`,"debug");return}try{const t=this.getData(e);const n=this.func(t);log(`executed ${this.func.name}`);return n}catch(e){log(`failed ${this.func.name}: ${e.toString()}`,"error")}}}class Feature extends FeatureBase{constructor(e,t,n){super(e,t,n);this.func=e;this.requires=n.requires}getData(){if(this.requires){const e=this.requires();if(!e||typeof e==="object"&&"length"in e&&e.length===0){throw"requirement not met"}return e}return undefined}}window.Feature=Feature;class Transformer extends FeatureBase{constructor(e,t,n){super(e,t,n);this.func=e}getData(e){return e}}const i=[new Feature(loadCUI,{ru:"Скрипт Николая",en:"Nicko script"},{group:"scripts"}),new Feature(loadEUI,{ru:"Скрипт Егора",en:"Egor script"},{group:"scripts",trigger:"mapReady",desktop:true}),new Feature(enableBackButton,{ru:"Разрешить кнопку Back",en:"Enable back button"},{group:"common",trigger:"mapReady",default:true}),new Feature(showBuilderPanel,{ru:"Включить конструктор (draw tools)",en:"Enable builder (draw tools)"},{group:"common",trigger:"mapReady",desktop:true}),new Feature(updateLangCacheAutomatically,{ru:"Автоматически обновлять кэш языка",en:"Update language cache automatically"},{group:"common",trigger:"mapReady",desktop:true,default:true}),new Feature(alignSettingsButtonsVertically,{ru:"Выровнять кнопки в настройках по ширине",en:"Align settings buttons vertically"},{group:"common",trigger:"mapReady",requires:()=>$(".settings"),desktop:true,default:true}),new Transformer(disableClusters,{ru:"Отключить ромашку",en:"Disable clusters"},{group:"cui",trigger:"cuiTransform"}),new Transformer(alwaysClearInventory,{ru:"Авто-очищать инвентарь после каждого дискавера",en:"Auto-delete inventory after every discover"},{group:"cui",trigger:"cuiTransform"}),new Feature(alwaysShowCUIToolbar,{ru:"Всегда раскрывать панель с кнопками скрипта Николая",en:"Always show Nicko script buttons"},{group:"cui",trigger:"mapReady",requires:()=>$(".sbgcui_toolbar")}),new Feature(fixSortButton,{ru:"Исправить расположение кнопки сортировки",en:"Fix sort button z-index"},{group:"cui",trigger:"mapReady",requires:()=>$(".sbgcui_refs-sort-button"),default:true}),new Feature(fixBlurryPopupText,{ru:"Починить замыленность текста в окнах",en:"Fix blurry text in popups"},{group:"eui",trigger:"mapReady",desktop:true,default:true}),new Feature(hideCloseButton,{ru:"Спрятать кнопку закрытия, закрывать только по нажатию Back",en:"Hide close button, close only by pressing Back"},{group:"windows",trigger:"mapReady",requires:()=>$(".popup-close, #inventory__close")}),new Feature(disableCarouselAnimation,{ru:"Отключить анимацию карусели",en:"Disable carousel animations"},{group:"animations",trigger:"pageLoad",requires:()=>window.Splide}),new Feature(disablePopupAnimation,{ru:"Отключить анимацию открытия и закрытия окон",en:"Disable open/close windows animation"},{group:"animations",trigger:"pageLoad",requires:()=>$(".popup")}),new Feature(closeToastsAfter1sec,{ru:"Закрывать всплывающие сообщения через 1 секунду",en:"Close toasts after 1 second"},{group:"animations",trigger:"pageLoad",requires:()=>window.Toastify}),new Feature(showQuickAutoSelectButton,{ru:"Показать кнопку для быстрого переключения автовыбора коров",en:"Show button for quick change auto-select settings"},{group:"toolbar",trigger:"mapReady",requires:()=>$(".sbgcui_toolbar")}),new Feature(moveAllSidebarsRight,{ru:"Показывать все боковые панели справа",en:"Move all sidebars to the right"},{group:"toolbar",trigger:"mapReady",requires:()=>$(".sbgcui_toolbar-control")}),new Feature(alwaysShowCompass,{ru:"Всегда показывать кнопку компаса",en:"Always show compass button"},{group:"toolbar",trigger:"mapReady",requires:()=>$(".ol-compass")}),new Feature(alwaysCenterAlignFireItemsCount,{ru:"Всегда выравнивать количество предметов по центру",en:"Always center align items count"},{group:"fire",trigger:"fireClick",requires:()=>$("#attack-slider")}),new Feature(replaceHighlevelWarningWithIcon,{ru:"Заменить предупреждение про недостаточный уровень на значок поверх предмета",en:"Replace highlevel warning with an icon on top of the item"},{group:"fire",trigger:"fireClick",requires:()=>$("#attack-slider")}),new Feature(joinFireButtons,{ru:"Объединить кнопку атаки и кнопку открытия панели атаки, закрывать панель кликом снаружи",en:"Join attack button and attack panel button, close panel by clicking outside"},{group:"fire",trigger:"fireClick",requires:()=>$("#attack-menu")}),new Feature(increaseItemsFont,{ru:"Увеличить размер шрифта за счёт сокращения названий предметов",en:"Increase font size by shortening item names"},{group:"inventory",trigger:"mapReady",requires:()=>$(".info.popup")}),new Feature(showAutoDeleteSettingsButton,{ru:"Показать кнопку перехода к настройкам авто-удаления",en:"Show auto-delete settings button"},{group:"inventory",trigger:"mapReady",requires:()=>$(".inventory.popup")}),new Feature(hideManualClearButtons,{ru:"Спрятать кнопки ручного удаления предметов",en:"Hide manual clear buttons"},{group:"inventory",trigger:"mapReady",requires:()=>$(".inventory__content")}),new Feature(restoreCUISort,{ru:"Заменить сортировку Егора на сортировку Николая",en:"Replace Egor sort with Nicko sort"},{group:"inventory",trigger:"mapReady",requires:()=>$(".inventory__content")}),new Feature(quickRecycleAllRefs,{ru:"Удалять все имеющиеся рефы от точки при нажатии кнопки удаления",en:"Recycle all existing refs of the point by clicking recycle button"},{group:"inventory",trigger:"mapReady",requires:()=>$(".inventory__content")}),new Feature(alwaysShowSelfStatistics,{ru:"Всегда показывать собственную статистику",en:"Always show self statistics"},{group:"leaderboard",trigger:"mapReady",requires:()=>window.__sbg_function_drawLeaderboard,desktop:true}),new Feature(makeInfoPopupSemiTransparent,{ru:"Сделать окно точки полупрозрачным",en:"Make info popup semi-transparent"},{group:"info",trigger:"mapReady",requires:()=>$(".info.popup")}),new Feature(alwaysShowSecondsForCoolDowns,{ru:"Всегда показывать отсчёт в секундах для кулдауна",en:"Always show seconds for cooldowns"},{group:"info",trigger:"mapReady",requires:()=>$("__sbg_function_timeToString")}),new Feature(enlargeCoreSlots,{ru:"Увеличить размер коров",en:"Enlarge core slots"},{group:"info",trigger:"mapReady",requires:()=>$(".info.popup")}),new Feature(alignCloseButtonVertically,{ru:"Выровнять кнопку закрытия по вертикали",en:"Align close button vertically"},{group:"info",trigger:"mapReady",requires:()=>$(".info.popup > .popup-close")}),new Feature(colorizeTimer,{ru:"Менять цвет таймера в зависимости от количества оставшихся дискаверов",en:"Change color of timer depending on remaining discovers"},{group:"info",trigger:"mapReady",requires:()=>$("#discover")}),new Feature(hideRepairButton,{ru:"Спрятать кнопку зарядки",en:"Hide repair button"},{group:"info",trigger:"mapReady",requires:()=>$(".info.popup")}),new Feature(replaceSwipeWithButton,{ru:"Показать кнопку для переключения между точками",en:"Show button to swipe between points"},{group:"info",trigger:"mapReady",requires:()=>$(".sbgcui_swipe-cards-arrow")}),new Feature(quickToggleInfoButtons,{ru:"Разрешить быстрое переключение между наборами кнопок",en:"Allow quick toggle buttons"},{group:"info",trigger:"mapReady",requires:()=>$(".info.popup .i-image-box")}),new Feature(selectTargetPointByClick,{ru:"Разрешить выбирать конечную точку кликом по ней",en:"Allow select target point by clicking it"},{group:"draw",trigger:"mapReady",requires:()=>window.__sbg_function_showInfo}),new Feature(highlightSelectedTargetPoint,{ru:"Подсвечивать выбранную конечную точку",en:"Highlight selected target point"},{group:"draw",trigger:"mapReady",requires:()=>window.__sbg_variable_map}),new Feature(matchDrawSliderButtons,{ru:"Расположить кнопку рисования ровно под кнопкой карусели рисования",en:"Place draw button exactly under draw carousel button"},{group:"draw",trigger:"mapReady",requires:()=>$(".draw-slider-wrp")}),new Feature(enableOldWebViewCompatibility,{ru:"Включить совместимость со старыми webview",en:"Enable old web view compatibility"},{group:"other",trigger:"mapReady",requires:()=>$(".popup.pp-center")})];const o={};o["common"]={enabled:[...i.filter((({group:e})=>e==="common")).map((({func:e})=>e))]};o["nicoscript"]={enabled:[...o["common"].enabled||[],loadCUI,...i.filter((({group:e})=>e==="cui")).map((({func:e})=>e))]};o["egorscript"]={enabled:[...o["common"].enabled||[],loadEUI,...i.filter((({group:e})=>e==="eui")).map((({func:e})=>e))]};o["allscripts"]={enabled:[...o["nicoscript"].enabled||[],...o["egorscript"].enabled||[],restoreCUISort]};o["oldwebview"]={enabled:[...o["allscripts"].enabled||[],enableOldWebViewCompatibility,disableClusters,alwaysShowSelfStatistics,alwaysShowSecondsForCoolDowns,matchDrawSliderButtons]};o["hot"]={disabled:[enableOldWebViewCompatibility,quickToggleInfoButtons]};o["full"]={disabled:[enableOldWebViewCompatibility]};o["default"]=o["allscripts"];o["public"]=o["allscripts"];class Settings{constructor(){this.storageKey="sbg-plus-settings";try{const e=localStorage[this.storageKey];const t=JSON.parse(e);this.features=t.features;this.cleanup()}catch{this.features={}}}getFeature(e){return this.features[e]}setFeature(e,t){this.features[e]=t;return this}cleanup(){const e=i.map((({func:e})=>e.name));Object.keys(this.features).filter((t=>!e.includes(t))).forEach((e=>delete this.features[e]))}save(){const e={};e.features=this.features;const t=JSON.stringify(e);localStorage[this.storageKey]=t}}const r=window.__sbg_plus_settings=new Settings;class Layers{constructor(){this.layers={}}get(e){const t=this.layers[e];return t}set(e,t){this.layers[e]=t}}const s=new Layers;const a=[];async function main(){if(location.pathname.startsWith("/login"))return;log(`started`);const e=initFeedback(3e4);window.__sbg_language=getLanguage();preventLoadingScript();enhanceEventListeners();await waitHTMLLoaded();initCSS();execFeatures("pageLoad");const t=await getNativeScript();await loadCUI(t);await wait((()=>window.__sbg_variable_map));initHome();initLayers();execFeatures("mapReady");execFireFeatures();await wait((()=>window.i18next&&window.i18next.translator));initSettings();log(`finished`);e()}function log(e,t="log"){console[t](`${e}`);a.push(e)}function initFeedback(e){const t=setTimeout((()=>{const e=document.createElement("span");e.style.position="fixed";e.style.left="2vw";e.style.top="2vh";e.style.width="92vw";e.style.height="92vh";e.style.padding="2vh 2vw";e.style.overflow="auto";e.style.zIndex="101";e.style.background="black";e.style.color="white";e.style.display="block";e.innerText=a.join("\n");document.body.appendChild(e)}),e);return()=>clearTimeout(t)}function showToast(e,t){window.Toastify({text:e.toString(),duration:t,forceDuration:true,gravity:"top",position:"right",className:"interaction-toast"}).showToast()}function getLanguage(){let e;try{e=JSON.parse(localStorage.settings).lang}catch{e=navigator.language}const t=["ru","uk","be","kk"].includes(e.split("-")[0])?"ru":"en";log(`detected language: ${t}`);return t}function addLayer(e,t){const n=new window.ol.source.Vector;const i=new window.ol.layer.Vector({source:n,className:`ol-layer__${e}`});i.setProperties({name:e,zIndex:s.get(t).getProperties().zIndex},true);window.__sbg_variable_map.get().addLayer(i);return i}function preventLoadingScript(){(e=>{Element.prototype.append=function(){if(arguments.length===0){return}if(arguments[0].src===getNativeScriptSrc()){return}e.apply(this,arguments)}})(Element.prototype.append);log(`prevented loading script`)}function getNativeScriptSrc(){return`https://sbg-game.ru/app/${isMobile()?"script.js":"intel.js"}`}function getCUIScriptSrc(){return"https://raw.githubusercontent.com/matrosby/sbg/master/cui.js"}function getEUIScriptSrc(){return"https://raw.githubusercontent.com/matrosby/sbg/master/eui.min.js"}function enhanceEventListeners(){((e,t)=>{EventTarget.prototype.addEventListener=function(t,n){if(!n)return;const i=this;i.__events=i.__events||{};i.__events[t]=i.__events[t]||{listeners:[]};if(i.__events[t].sealed)return;i.__events[t].listeners.push(n);e.apply(this,arguments)};EventTarget.prototype.removeEventListener=function(e,n){if(!n)return;const i=this;i.__events=i.__events||{};i.__events[e]=i.__events[e]||{listeners:[]};const o=i.__events[e].listeners.indexOf(n);if(o!==-1){i.__events[e].listeners.splice(o,1)}t.apply(this,arguments)};EventTarget.prototype.getEventListeners=function(e){const t=this;t.__events=t.__events||{};t.__events[e]=t.__events[e]||{listeners:[]};const n=[];for(const i of t.__events[e].listeners){if(!i)continue;n.push(i)}return n};EventTarget.prototype.getEventHandlers=function(e){const t=this;return t.getEventListeners(e).map((e=>"handleEvent"in e?e.handleEvent:e)).map((e=>e))};EventTarget.prototype.clearEventListeners=function(e,n){const i=this;i.__events=i.__events||{};i.__events[e]=i.__events[e]||{listeners:[]};if(n){i.__events[e].sealed=true}for(const n of i.__events[e].listeners){t.apply(i,[e,n])}i.__events[e].listeners.splice(0)};EventTarget.prototype.addOnlyEventListener=function(t,n){if(!n)return;const i=this;i.clearEventListeners(t,true);i.__events[t].listeners.push(n);e.apply(this,arguments)}})(EventTarget.prototype.addEventListener,EventTarget.prototype.removeEventListener);log(`enhanced event listeneres`)}async function loadCUI(e){var t;if(!((t=i.find((({func:e})=>e===loadCUI)))===null||t===void 0?void 0:t.isEnabled())){log(`CUI disabled; loading native script`);embedScript(e);return}log(`CUI disabled; loading CUI script with native script`);const n=await transformScript(getCUIScriptSrc(),"__sbg_cui_script",transformCUIScript);embedScript(n);await wait((()=>window.cuiStatus==="loaded"))}function transformCUIScript(e){e=fixCompatibility(e);e=fixGotoReference(e);i.filter((({trigger:e})=>e==="cuiTransform")).map((t=>e=t.exec(e)));return e}async function waitHTMLLoaded(){return new Promise((e=>{let t=false;function resolveOnce(){if(t)return;t=true;e();log(`loaded DOM content`)}document.addEventListener("DOMContentLoaded",resolveOnce);if(document.readyState!=="loading"){resolveOnce()}}))}async function getNativeScript(){return transformScript(getNativeScriptSrc(),"__sbg_script",transformNativeScript)}function isMobile(){if("maxTouchPoints"in navigator){return navigator["maxTouchPoints"]>0}else if("msMaxTouchPoints"in navigator){return navigator["msMaxTouchPoints"]>0}else if("orientation"in window){return true}else{return/\b(BlackBerry|webOS|iPhone|IEMobile|Android|Windows Phone|iPad|iPod)\b/i.test(navigator["userAgent"])}}async function transformScript(e,t,n){const i=`${t}_original`;const o=`${t}_modified`;return fetch(e).then((e=>e.text())).then((e=>{Object.defineProperty(window,i,{value:e});e=n(e);Object.defineProperty(window,o,{value:e});log(`transformed script: ${i} => ${o}`);return e}))}function loadEUI(){window.cuiStatus="loaded";if(window.egorScript){window.egorScript()}else{loadScript(getEUIScriptSrc())}}function loadScript(e){const t=document.createElement("script");t.type="text/javascript";t.src=e;document.head.appendChild(t)}function embedScript(e){const t=document.createElement("script");t.type="text/javascript";t.textContent=e;document.head.appendChild(t)}function transformNativeScript(e){e=includeYMaps(e);e=exposeScriptData(e,"__sbg",{variables:{readable:["draw_slider","FeatureStyles","is_dark","ItemTypes","LANG","map","TeamColors","temp_lines_source","units","VERSION"]},functions:{readable:["apiQuery","deleteInventoryItem","jquerypassargs","openProfile","takeUnits"],writable:["drawLeaderboard","manageDrawing","movePlayer","showInfo","timeToString"],disabled:!isMobile()&&localStorage["homeCoords"]?["movePlayer"]:undefined}});return e}function includeYMaps(e){const n="ymaps";let i;try{JSON.parse(localStorage.settings).base===n}catch{i=localStorage["sbg-plus-state-ymaps"]==="1"}const o=$('<input type="radio" />').attr("name","baselayer").val(n).prop("checked",i);const r=$("<span></span>").text(t.ymaps.toString());const s=$("<label></label>").addClass("layers-config__entry").append(o).append(" ").append(r);$('input[value="osm"]').parent().after(s);e=e.replace(`if (type == 'osm') {`,`if (type == '${n}') { \n  theme = is_dark ? 'dark' : 'light';\n  source = new ol.source.XYZ({ url: \`https://core-renderer-tiles.maps.yandex.net/tiles?l=map&x={x}&y={y}&z={z}&scale=1&projection=web_mercator&theme=\${theme}&lang=\${window.__sbg_language}\` });\n} else if (type == 'osm') {\n`);return e}function exposeScriptData(e,t,{variables:n,functions:i}){e=e.replace(/((?:^|\n)\s*)(const|let)\s+(\w+)(?=[\s+,\n$])/g,((e,i,o,r)=>{var s,a;if((s=n===null||n===void 0?void 0:n.readable)===null||s===void 0?void 0:s.includes(r)){return`${i}window.${t}_variable_${r} = { get: () => ${r} };\n${i}${o} ${r}`}if((a=n===null||n===void 0?void 0:n.writable)===null||a===void 0?void 0:a.includes(r)){return`${i}window.${t}_variable_${r} = { get: () => ${r}, set: (value) => ${r} = value };\n${i}let ${r}`}return e}));e=e.replace(/(?:^|\n)\s*(async\s+)?function\s+(\w+)\s*\((.*?)\)\s*\{/g,((e,n,o,r)=>{var s,a,l;n=n||"";if((s=i===null||i===void 0?void 0:i.disabled)===null||s===void 0?void 0:s.includes(o)){return`${e} return;`}if((a=i===null||i===void 0?void 0:i.readable)===null||a===void 0?void 0:a.includes(o)){return`\nwindow.${t}_function_${o} = ${o};\n${e}`}if((l=i===null||i===void 0?void 0:i.writable)===null||l===void 0?void 0:l.includes(o)){return`${e}\n\treturn window.${t}_function_${o}(...arguments);\n}\nwindow.${t}_function_${o} = ${n}function(${r}) {`}return e}));return e}function setCSS(e){$("<style></style>").html(e).appendTo(document.body)}window.setCSS=setCSS;function initCSS(){setCSS(`\n            .topleft-container,\n            .bottom-container {\n                z-index: 1;\n            }\n\n            .popup > .popup.sbg-plus-settings {\n                left: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n                transform: none;\n                position: absolute;\n                padding: 0.5em 1em;\n            }\n\n            .sbg-plus-settings .settings-content {\n                width: 100%;\n            }\n\n            .sbg-plus-settings .settings-section h4 {\n                margin: 1em 0 0.5em 0;\n            }\n\n            .sbg-plus-settings .settings-section__item {\n                display: flex;\n            }\n\n            .sbg-plus-settings .settings-section__item span {\n                flex-grow: 1;\n            }\n\n            .sbg-plus-popup {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 0.5em;\n            }\n\n            .sbg-plus-popup textarea {\n                display: block;\n                width: 90vw;\n                max-width: 800px;\n                height: 90vh;\n                overflow: auto;\n                padding: 0.5em;\n                box-sizing: border-box;\n                font-family: sans-serif;\n            }\n\n            .sbg-plus-popup li {\n                padding: 0.25em 0;\n            }\n\n            .sbg-plus-popup .buttons {\n                display: flex;\n                gap: 0.5em;\n            }\n\n            .sbg-plus-popup .buttons .popup-close-simple {\n                filter: grayscale(1);\n            }\n        `);log(`initialized CSS`)}function wait(e){return new Promise((t=>{const n=setInterval((()=>{const i=e();if(!i)return;clearInterval(n);t(i)}),10)}))}function initSettings(){const e=createSettingsPopup();const n=$("<button></button>").addClass("settings-section__button").text(t.settings.button.toString()).on("click",(()=>e.removeClass("hidden")));const i=createSetting(t.settings.title,n);$(".settings .settings-section:first .settings-section__item:first").before(i);const o=$("<span></span>").text(`v${window.__sbg_plus_version}`);const r=createSetting(t.settings.version,o);$('.settings [data-i18n="settings.about.version"]').parent().after(r);log(`initialized settings`)}function createSettingsPopup(){const e=$(".settings");const o=createPopup("sbg-plus-settings",{roundClose:false}).appendTo(e);const s=$("<div></div>").addClass("settings-content");const l=$("<h3></h3>").text(t.settings.title.toString());o.prepend(l,s);Object.keys(n).forEach((e=>{const t=n[e];const o=i.filter((t=>t.group===e&&t.isAvailable()));if(o.length===0){return}const r=$("<h4></h4>").text(new Label(t).toString());const a=$("<div></div>").addClass("settings-section").append(r);for(const e of o){const t=createCheckbox(e);const n=createSetting(t,e.label);a.append(n)}s.append(a)}));const c=$("<button></button>").text(window.i18next.t("buttons.save")).on("click",(()=>{r.save();window.location.reload()}));const d=$("<button></button>").text(t.settings.logs.toString()).on("click",(()=>navigator.clipboard.writeText(a.join("\n")).then((()=>showToast(t.toasts.logs,2e3)))));o.find(".buttons").prepend(c);o.find(".buttons").append(d);return o}function createSetting(...e){const t=$("<label></label>").addClass("settings-section__item");for(const n of e){const e=n instanceof Label?$("<span></span>").text(n.toString()):n;t.append(e)}return t}function createCheckbox(e){return $('<input type="checkbox" />').prop("checked",e.isEnabled()).on("change",(t=>{e.setEnabled(t.target.checked)}))}function createPopup(e,t={roundClose:true}){var n;const i=$("<button></button>").addClass(t.roundClose?"popup-close":"popup-close-simple").attr("data-round",t.roundClose?"true":null).html(t.roundClose?"&nbsp;✕&nbsp;":window.i18next.t("buttons.close"));const o=$("<div></div>").addClass("buttons").append(i);const r=$("<div></div>").addClass(`${e} sbg-plus-popup popup pp-center hidden`).append(o).appendTo("body");(n=i.get(0))===null||n===void 0?void 0:n.addOnlyEventListener("click",(function(){r.addClass("hidden")}));return r}function initHome(){if(isMobile()||!("homeCoords"in localStorage)){return}const e=JSON.parse(localStorage.homeCoords);window.__sbg_variable_map.get().getView().setCenter(e);log(`initialized home location`)}function initLayers(){for(const e of window.__sbg_variable_map.get().getAllLayers()){s.set(e.getProperties().name,e)}log(`initialized layers`)}function execFeatures(e){i.filter((t=>t.trigger===e)).map((e=>e.exec()));log(`executed all features on ${e}`)}function execFireFeatures(){let e=false;$("#attack-menu").on("click",(()=>{if(!e){e=true;execFeatures("fireClick")}}))}function fixCompatibility(e){waitHTMLLoaded().then((async()=>{await wait((()=>window.cuiEmbedded));await wait((()=>window.ol));window.addEventListener("mapReady",window.__sbg_cui_function_main);window.__sbg_cui_function_olInjection();window.__sbg_cui_function_loadMainScript();log(`fixed CUI compatibility`)}));e=e.replace(`fetch('/script.js')`,`(async () => ({ text: async () => window.__sbg_script_modified }))()`).replace(`window.stop`,`// window.stop`).replace(`fetch('/')`,`if (false) fetch('/')`).replace(/$/,`window.cuiEmbedded = true`);e=exposeScriptData(e,"__sbg_cui",{functions:{readable:["olInjection","loadMainScript","main"]}});return e}function fixGotoReference(e){$(document).on("click",'a[href*="point="]',(e=>{var t;const n=(t=e.currentTarget.href.split("point=").pop())===null||t===void 0?void 0:t.split("&").shift();window.__sbg_function_showInfo(n);e.stopPropagation();return false}));return e.replace("window.location.href = `/?point=${guid}`","window.__sbg_function_showInfo(guid)")}function disableClusters(e){return e.replace("function mapClickHandler(event) {","function mapClickHandler(event) { event.isSilent = true;")}function alwaysClearInventory(e){return e.replace(/const MIN_FREE_SPACE = \d+/,"const MIN_FREE_SPACE = INVENTORY_LIMIT").replace("if (event.target == discoverButton) { clearInventory(); }","clearInventory();")}function fixBlurryPopupText(){setCSS(`\n            .popup.pp-center {\n                backdrop-filter: none;\n                -webkit-backdrop-filter: none;\n            }\n\n            .popup.pp-center:before {\n                content: '';\n                position: absolute;\n                left: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n                -webkit-backdrop-filter: blur(5px);\n                backdrop-filter: blur(5px);\n            }\n\n            .popup.pp-center > * {\n                position: relative;\n            }\n        `)}function disableCarouselAnimation(){window.Splide.defaults=window.Splide.defaults||{};window.Splide.defaults.speed=0}function disablePopupAnimation(){setCSS(`\n            .popup {\n                transition: none !important;\n            }\n        `)}function closeToastsAfter1sec(){(e=>{window.Toastify.prototype.init=function(t){if(!t.forceDuration){t.duration=Math.min(t.duration||0,1e3)}e.call(this,t);return this};window.Toastify.prototype.init.prototype=e.prototype})(window.Toastify.prototype.init)}function enableBackButton(){const e=1e3;let n=false;const i=[{hiddenClass:"hidden",selectors:[".popup",".draw-slider-wrp",".attack-slider-wrp"]},{hiddenClass:"sbgcui_hidden",selectors:[".sbgcui_settings"]}];function isPopupClosed(){for(const{hiddenClass:e,selectors:t}of i){for(const n of t){for(const t of $(n).toArray()){if(!t.classList.contains(e)){t.classList.add(e);if(n===".draw-slider-wrp"){$("#draw-slider-close").trigger("click")}if(n===".attack-slider-wrp"){$("#attack-menu").removeClass("sbgcui_attack-menu-rotate")}return true}}}}return false}document.addOnlyEventListener("backbutton",(()=>{if(isPopupClosed()){n=false;return}if(n){location.replace("/window.close")}else{showToast(t.toasts.back,e);n=true;setTimeout((()=>{n=false}),e)}}))}function showBuilderPanel(){wait((()=>$(".topleft-container"))).then((e=>new Builder(e)))}function updateLangCacheAutomatically(){const e=setInterval((()=>{const t=window.__sbg_variable_VERSION.get();if(!t)return;clearInterval(e);const n="__sbg_current_version";const i=localStorage[n]||"unknown";localStorage[n]=t;if(i!==t){log(`update lang cache from ${i} version to ${t} version`);$("#lang-cache").trigger("click")}}),50)}function enableOldWebViewCompatibility(){setCSS(`\n            @media (max-width: 425px) {\n                .popup.pp-center {\n                    top: 0 !important;\n                    left: 0 !important;\n                    translate: none !important;\n                }\n            }\n        `)}function alignSettingsButtonsVertically(){setCSS(`\n            .settings-section__button {\n                justify-self: unset !important;\n            }\n        `)}function alwaysCenterAlignFireItemsCount(){setCSS(`\n        .splide__slide[data-rarity] .catalysers-list__amount {\n            display: block !important;\n        }\n        .splide__slide[data-rarity] .catalysers-list__amount:before {\n            content: '';\n            display: inline-block;\n            background: currentColor;\n            width: 1em;\n            height: 1em;\n            position: absolute;\n            right: 8px;\n            font-size: 0.85em;\n            bottom: 5px;\n        }\n        `)}function replaceHighlevelWarningWithIcon(e){const t=e.height();setCSS(`\n            #attack-slider {\n                padding: 4px 0;\n            }\n\n            .attack-slider-highlevel {\n                pointer-events: none;\n                font-size: 36px;\n                width: 1px;\n                height: ${t}px;\n                margin: -${t}px auto 0 auto;\n                background: none;\n                backdrop-filter: none;\n                -webkit-backdrop-filter: none;\n                text-align: center;\n                display: block;\n                z-index: 1;\n            }\n        `);$(".attack-slider-highlevel").html("&#x20e0")}function joinFireButtons(e){const t=e.outerHeight();setCSS(`\n            .attack-slider-wrp {\n                transition: none;\n                position: relative;\n                z-index: 3;\n            }\n\n            .attack-slider-buttons {\n                position: absolute;\n                top: 100%;\n                left: 50%;\n                padding: 0;\n            }\n\n            #attack-slider-fire {\n                max-width: ${t}px;\n                height: ${t}px;\n                opacity: 0;\n                position: relative;\n                left: -50%;\n            }\n\n            #attack-menu.sbgcui_attack-menu-rotate::after {\n                background: var(--ingress-selection-color);\n            }\n\n            #attack-menu.sbgcui_attack-menu-rotate {\n                border-color: var(--ingress-selection-color);\n            }\n        `);$(window).on("click",(function(e){const t=e.target;if(t.id!=="attack-menu"&&$(".attack-slider-wrp.hidden").length===0&&$(t).parents(".attack-slider-wrp").length===0){$("#attack-menu").trigger("click")}}))}function showQuickAutoSelectButton(e){const t=JSON.parse(localStorage.sbgcui_config).autoSelect;const n=t.deploy==="max"?"fa-rotate-180":"";const i=$("<button></button>").addClass("fa fa-solid-arrow-down-short-wide").addClass(n).appendTo(e.parent());i.on("click",(()=>{i.toggleClass("fa-rotate-180");const e=i.hasClass("fa-rotate-180");$('select[name="autoSelect_deploy"]').val(e?"max":"min");$('select[name="autoSelect_upgrade"]').val(e?"max":"min");$('form.sbgcui_settings button:contains("Сохранить")').trigger("click")}));setCSS(`\n            .fa-rotate-180 {\n                transform: scale(-1, 1);\n            }\n        `)}function alwaysShowCUIToolbar(){setCSS(`\n            .sbgcui_toolbar {\n                display: block !important;\n            }\n\n            .sbgcui_toolbar + button {\n                display: none !important;\n            }\n        `)}function moveAllSidebarsRight(e){e.children().prependTo($(".ol-control").first())}function alwaysShowCompass(e){e.addClass("fa fa-solid-location-arrow").html("");setCSS(`\n            .ol-compass {\n                height: 100%;\n            }\n            .ol-rotate {\n                margin-top: 0 !important;\n            }\n            .ol-rotate.ol-hidden {\n                opacity: 1 !important;\n                visibility: visible !important;\n                margin-top: 0;\n            }\n\n            .fa-solid-location-arrow {\n                --fa-url: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='1em' viewBox='-48 0 512 512'%3E%3Cpath d='M429.6 92.1c4.9-11.9 2.1-25.6-7-34.7s-22.8-11.9-34.7-7l-352 144c-14.2 5.8-22.2 20.8-19.3 35.8s16.1 25.8 31.4 25.8H224V432c0 15.3 10.8 28.4 25.8 31.4s30-5.1 35.8-19.3l144-352z'/%3E%3C/svg%3E");\n            }\n\n            .fa-solid-location-arrow:before {\n                transform: rotate(-45deg);\n                display: block;\n                position: relative;\n                top: 4px;\n                font-size: 0.9em;\n            }\n        `)}function showAutoDeleteSettingsButton(e){$("<button></button>").text("Auto-delete").css({height:"40px"}).appendTo(e).on("click",(()=>{$("#inventory__close").trigger("click");$(".sbgcui_settings").removeClass("sbgcui_hidden");$('.sbgcui_settings-title:contains("Автоудаление")').trigger("click")}))}function hideManualClearButtons(){setCSS(`\n            .inventory__controls {\n                height: 0;\n                min-height: 0;\n                overflow: hidden;\n            }\n\n            .inventory__content[data-tab="3"] ~ .inventory__controls > select {\n                position: fixed;\n                right: 0;\n                bottom: 51px;\n                height: 40px;\n                flex-grow: 0;\n                flex-shrink: 0;\n                margin: 0 4px;\n                width: calc(100% - 8px);\n                text-align: center;\n            }\n\n            .inventory__content[data-tab="3"] ~ .inventory__controls > .sbgcui_refs-sort-button {\n                border-width: revert;\n                border-radius: 0;\n                bottom: 51px;\n                z-index: 2;\n                right: 4px;\n                height: 40px;\n                width: 40px;\n                font-size: 20px;\n            }\n\n            #inventory__close {\n                bottom: 102px;\n            }\n\n            .inventory__content[data-tab="3"] {\n                margin-bottom: 41px;\n            }\n        `)}function alwaysShowSelfStatistics(e){window.__sbg_function_drawLeaderboard=async function(){var t;await e();const n={owned:"owned_points"};const i=((t=$("#leaderboard__term-select").val())===null||t===void 0?void 0:t.toString())||"";const o=(await window.__sbg_function_apiQuery("profile",{guid:$("#self-info__name").data("guid")})).response.data;const r=o[n[i]||i];const s=window.__sbg_function_jquerypassargs($("<li>"),"$1$ — $2$; $3$ $4$",$("<span>",{class:"profile-link"}).text(o.name).css("color",`var(--team-${o.team})`).attr("data-name",o.name).on("click",window.__sbg_function_openProfile),$("<span>").text(window.i18next.t("leaderboard.level",{count:o.level})).css("color",`var(--level-${o.level})`),...window.__sbg_function_takeUnits(r));const a=$("<ol>").addClass("leaderboard__list_self").attr("start",$("#leaderboard__place-pos").text()).append(s);$(".leaderboard__list_self").remove();$(".leaderboard__list").after(a)};setCSS(`\n            .leaderboard__list_self {\n                flex-shrink: 0;\n                border-top: 1px solid white;\n                margin: 0;\n                overflow-y: auto;\n                padding-left: 3em;\n            }\n        `)}function restoreCUISort(){setCSS(`\n            .inventory__content[data-tab="3"] ~ .inventory__controls > #eui-sort {\n                display: none !important;\n            }\n\n            .inventory__content[data-tab="3"] ~ .inventory__controls > .sbgcui_refs-sort-button,\n            .inventory__content[data-tab="3"] ~ .inventory__controls > .sbgcui_refs-sort-select {\n                display: block !important;\n            }\n        `)}function fixSortButton(e){setCSS(`\n            .sbgcui_refs-sort-button {\n                z-index: 100 !important;\n            }\n        `)}function quickRecycleAllRefs(e){setCSS(`\n            .inventory__content[data-tab="3"] .inventory__item {\n                display: flex;\n                flex-direction: row;\n            }\n\n            .inventory__content[data-tab="3"] .inventory__item-left {\n                order: 0;\n            }\n\n            .inventory__content[data-tab="3"] .inventory__item-controls {\n                flex-direction: row;\n            }\n\n            .inventory__content[data-tab="3"] .inventory__item-controls button {\n                width: 30px;\n                margin-left: 4px;\n            }\n\n            .inventory.popup .inventory__manage-amount[data-tab="3"] {\n                display: none;\n            }\n        `);const t=e.get(0);t.getEventListeners("click").forEach((e=>t.removeEventListener("click",e)));$(document).on("click",".inventory__content",(async function(e){if(!e.target){return}if(!$(e.target).is(".inventory__ic-manage")){if($(e.target).is(".inventory__ic-view")){e.offsetX=0}t.getEventHandlers("click").map((t=>e.originalEvent&&t(e.originalEvent)));return}const n=$(e.target).parents(".inventory__item");const i=(JSON.parse(localStorage.getItem("inventory-cache")||"[]")||[]).find((e=>e.g==n.attr("data-guid")));if(!i)return;const o=$("<input />").addClass("inventory__ma-amount").val(i.a).css({display:"none"});Object.defineProperty(o.get(0),"reportValidity",{value:()=>true});n.append(o);n.attr("data-tab",i.t);await window.__sbg_function_deleteInventoryItem(n)}))}function makeInfoPopupSemiTransparent(){setCSS(`\n            .info.popup {\n                background-color: transparent;\n            }\n        `)}function alwaysShowSecondsForCoolDowns(){const e=90;const t=100;const n=60;window.__sbg_function_timeToString=function(e){return e>=t?window.i18next.t("units.min",{count:Math.floor(e/60)}):window.i18next.t("units.sec",{count:e})};setCSS(`\n            #discover[data-remain] .discover-progress {\n                transform: scale(${n/e}, 1);\n                transform-origin: left;\n            }\n        `)}function increaseItemsFont(){setCSS(`\n            .inventory__content:not([data-tab="3"]) {\n                display: flex;\n                flex-direction: column;\n                flex-wrap: wrap;\n                counter-reset: section;\n            }\n\n            .inventory__content:not([data-tab="3"]) .inventory__item {\n                height: calc((100% - 120px) / 5);\n                width: 50%;\n                box-sizing: border-box;\n            }\n\n            .inventory__content:not([data-tab="3"]) .inventory__item-title {\n                height: 2em;\n                margin-top: 0.8em;\n                font-size: 2em;\n            }\n\n            .inventory__content:not([data-tab="3"]) .inventory__item-descr {\n                margin-left: 0;\n                margin-top: -0.8em;\n                font-size: 1.3em !important;\n            }\n\n            .inventory__content:not([data-tab="3"]) .inventory__item-descr::first-letter {\n                font-size: 0;\n            }\n        `);const e=window.__sbg_variable_ItemTypes.get();e[1]="R";e[2]="X";e[3]="K";e[4]="Br"}function enlargeCoreSlots(){setCSS(`\n            .i-stat__cores {\n                padding: 4px 0;\n            }\n\n            .i-stat__core {\n                font-size: 140%;\n            }\n        `)}function alignCloseButtonVertically(){setCSS(`\n            .info.popup > .popup-close {\n                margin-top: -0.5em;\n                margin-bottom: calc(0.5em - 10px);\n            }\n        `)}function rearrangeButtons(){setCSS(`\n            .i-stat .i-buttons {\n                --discover-left: 0/6;\n                --discover-right: 0/6;\n\n                --discover-gap: 0.25em;\n                --discover-border: 1.9px;\n                --discover-parent: calc(0.9 * (100vw - 2 * var(--discover-border)) + 2 * var(--discover-gap));\n                --discover-font-size: 1.1em;\n\n                --discover-left-offset: calc(var(--discover-left) * (var(--discover-parent) + var(--discover-gap)));\n                --discover-right-offset: calc(var(--discover-right) * (var(--discover-parent) + var(--discover-gap)));\n\n                --discover-width: calc(var(--discover-parent) - var(--discover-left-offset) - var(--discover-right-offset));\n\n                --discover-sibling-left-width: calc(var(--discover-left) * var(--discover-parent) - var(--discover-gap));\n                --discover-sibling-right-width: calc(var(--discover-right) * var(--discover-parent) - var(--discover-gap));\n\n                --discover-sibling-left-offset: calc(-1 * var(--discover-left-offset) - var(--discover-border));\n                --discover-sibling-right-offset: calc(-1 * var(--discover-right-offset) - var(--discover-border));\n\n                --discover-alt-button-width: calc(1/6 * (var(--discover-parent) - 2 * var(--discover-gap)) - 0.5 * var(--discover-border));\n            }\n\n            .i-buttons button {\n                border-width: 2px;\n            }\n\n            #discover {\n                margin-left: var(--discover-left-offset);\n                margin-right: var(--discover-right-offset);\n                width: var(--discover-width);\n            }\n\n            .sbgcui_no_loot,\n            .sbgcui_no_refs {\n                width: var(--discover-alt-button-width);\n                padding: 0 calc(0.5 * var(--discover-gap));\n                border-color: currentColor !important;\n            }\n        `)}function hideCloseButton(){$("#draw").on("click",(e=>$(".draw-slider-buttons button").css({height:`${$(e.target).outerHeight()}px`})));$("body").addClass("noclose");setCSS(`\n            .noclose .popup-close,\n            .noclose #inventory__close,\n            .noclose #draw-slider-close {\n                display: none !important;\n            }\n\n            .noclose .draw-slider-buttons {\n                padding: 0 calc(5%);\n                gap: 0.25em;\n            }\n\n            .noclose .draw-slider-buttons button {\n                width: calc(50% - 0.125em);\n                max-width: none !important;\n                padding: 6px;\n                font-size: 1.1em;\n            }\n\n            .noclose .i-stat .i-buttons {\n                margin: 0;\n            }\n        `)}function colorizeTimer(){$("body").addClass("richtimer");rearrangeButtons();setCSS(`\n            .richtimer .i-stat .i-buttons {\n                --discover-left: 1/6;\n            }\n\n            .richtimer #discover:after {\n                transform: none;\n                width: var(--discover-sibling-left-width);\n                left: var(--discover-sibling-left-offset);\n                height: calc(100% + 2 * var(--discover-border));\n                top: calc(-1 * var(--discover-border));\n                box-sizing: border-box;\n                line-height: 40px;\n                border: var(--discover-border) solid currentColor;\n                color: var(--ingress-btn-border-color);\n                border-color: currentColor;\n                content: ' ';\n            }\n\n            .richtimer #discover[data-time]:after {\n                content: attr(data-time);\n            }\n\n            .richtimer #discover[data-time][data-remain]:after {\n                content: attr(data-time) ' #' attr(data-remain);\n            }\n\n            .richtimer #discover[data-time]:after {\n                color: var(--ingress-btn-disabled-color);\n                border-color: var(--ingress-btn-disabled-accent-color);\n            }\n\n            .richtimer #discover[data-time][data-remain]:after {\n                background: none;\n                border-color: currentColor;\n            }\n\n            .richtimer #discover[data-time][data-remain="4"]:after {\n                color: var(--ingress-btn-border-color);\n            }\n\n            .richtimer #discover[data-time][data-remain="3"]:after {\n                color: white;\n            }\n\n            .richtimer #discover[data-time][data-remain="2"]:after {\n                color: yellow;\n            }\n\n            .richtimer #discover[data-time][data-remain="1"]:after {\n                color: orange;\n            }\n        `)}function hideRepairButton(){$("body").addClass("norepair");rearrangeButtons();setCSS(`\n            .norepair #repair,\n            .norepair #eui-repair {\n                display: none;\n            }\n\n            .norepair .i-stat .i-buttons > button:not(#discover) {\n                width: calc(45% + 0.125em);\n            }\n        `)}function replaceSwipeWithButton(e){$("body").addClass("noswipe");rearrangeButtons();e.hide();function createTouch(e){var t,n,i,o,r,s,a,l,c,d,u,g,p,f,h;const b=[{clientX:(t=e.clientX)!==null&&t!==void 0?t:0,clientY:(n=e.clientY)!==null&&n!==void 0?n:0,pageX:(o=(i=e.pageX)!==null&&i!==void 0?i:e.clientX)!==null&&o!==void 0?o:0,pageY:(s=(r=e.pageY)!==null&&r!==void 0?r:e.clientY)!==null&&s!==void 0?s:0,screenX:(l=(a=e.screenX)!==null&&a!==void 0?a:e.clientX)!==null&&l!==void 0?l:0,screenY:(d=(c=e.screenY)!==null&&c!==void 0?c:e.clientY)!==null&&d!==void 0?d:0,force:(u=e.force)!==null&&u!==void 0?u:0,identifier:(g=e.identifier)!==null&&g!==void 0?g:0,radiusX:(p=e.radiusX)!==null&&p!==void 0?p:1,radiusY:(f=e.radiusY)!==null&&f!==void 0?f:1,rotationAngle:(h=e.rotationAngle)!==null&&h!==void 0?h:0,target:e.target}];const w=new Set(b);return{touches:{length:w.size,item:e=>b[e],[Symbol.iterator]:w[Symbol.iterator]}}}function swipe(e,[t,n],[i,o]){const r=Math.random()*Number.MAX_SAFE_INTEGER;const s=createTouch({target:e,identifier:r,clientX:t,clientY:n});const a=createTouch({target:e,identifier:r,clientX:i,clientY:o});const l=e.getEventHandlers("touchstart").filter((e=>e.name==="touchStartHandler"));const c=e.getEventHandlers("touchmove").filter((e=>e.name==="touchMoveHandler"));const d=e.getEventHandlers("touchend").filter((e=>e.name==="touchEndHandler"));l.map((e=>e(s)));c.map((e=>e(s)));c.map((e=>e(a)));d.map((e=>e(a)))}const t=$("<button></button>").addClass("next").html('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" width="40" height="40" focusable="false"><path d="m15.5 0.932-4.3 4.38 14.5 14.6-14.5 14.5 4.3 4.4 14.6-14.6 4.4-4.3-4.4-4.4-14.6-14.6z"></path></svg>').on("click",(e=>{const t=document.querySelector(".info.popup");swipe(t,[200,0],[0,0]);e.stopPropagation();return false})).appendTo($("#discover"));new MutationObserver((n=>n.filter((({attributeName:e})=>e==="class")).map((()=>{t.prop("disabled",e.hasClass("sbgcui_hidden"))})))).observe(e.get(0),{attributes:true});setCSS(`\n            .i-stat .i-buttons .next {\n                display: none;\n            }\n\n            .noswipe .i-stat .i-buttons {\n                --discover-right: 1/6;\n            }\n\n            .noswipe .i-stat .i-buttons .next {\n                display: block;\n                position: absolute;\n                width: var(--discover-sibling-right-width);\n                right: var(--discover-sibling-right-offset);\n                height: calc(100% + 2 * var(--discover-border));\n                top: calc(-1 * var(--discover-border));\n                color: var(--ingress-btn-color);\n                background: linear-gradient(to top, var(--ingress-btn-glow-color) 0%, var(--ingress-btn-bg-color) 30%, var(--ingress-btn-bg-color) 70%, var(--ingress-btn-glow-color) 100%), var(--ingress-btn-bg-color);\n                border: 2px solid var(--ingress-btn-border-color);\n            }\n\n            .noswipe .i-stat .i-buttons .next:disabled {\n                color: var(--ingress-btn-disabled-color);\n                background: var(--ingress-btn-disabled-bg-color);\n                border-color: var(--ingress-btn-disabled-accent-color);\n            }\n\n            .noswipe .i-stat .i-buttons .next:active {\n                filter: saturate(2);\n            }\n\n            .noswipe .i-stat .i-buttons .next svg {\n                height: 16px;\n                position: relative;\n                top: 2px;\n            }\n\n            .noswipe .i-stat .i-buttons .next svg path {\n                fill: currentColor;\n            }\n        `)}function quickToggleInfoButtons(e){const t=$("<div></div>").addClass("i-buttons").appendTo(e);function toggleClass(e,t){e.toggleClass("off",!$("body").hasClass(t))}[{title:"CL",cssClass:"noclose"},{title:"RE",cssClass:"norepair"},{title:"SW",cssClass:"noswipe"},{title:"TM",cssClass:"richtimer"}].forEach((({title:e,cssClass:n})=>{const i=$("<button></button>").html(e).appendTo(t);toggleClass(i,n);i.on("click",(()=>{$("body").toggleClass(n);toggleClass(i,n)}))}));setCSS(`\n            .i-image-box .i-buttons {\n                position: absolute;\n                left: 0;\n                bottom: 0;\n                justify-content: flex-start;\n                direction: ltr;\n            }\n\n            .i-image-box .i-buttons button {\n                width: auto;\n                position: relative;\n                z-index: 1;\n                font-size: 0.85em;\n            }\n\n            .i-image-box .i-buttons button.off {\n                filter: saturate(0.15);\n            }\n        `)}function selectTargetPointByClick(){(e=>{window.__sbg_function_showInfo=function(t){if(!$("#draw-slider").is(":visible")){e(t)}else{const e=$(`#draw-slider li[data-point="${t}"]`);if(e.length>0){window.__sbg_variable_draw_slider.get().go(e.index())}}}})(window.__sbg_function_showInfo)}function highlightSelectedTargetPoint(){const e=addLayer("highlights","points");(t=>{window.__sbg_variable_temp_lines_source.get().clear=function(n){t.call(this,n);e.getSource().clear(n)}})(window.__sbg_variable_temp_lines_source.get().clear);(t=>{window.__sbg_function_manageDrawing=function(n){t(n);const i=window.__sbg_variable_temp_lines_source.get().getFeatures()[0];const o=i.getGeometry().flatCoordinates;const r=new window.ol.Feature({geometry:new window.ol.geom.Circle([o.slice(o.length-2)],16)});const s=new window.ol.style.Style({stroke:new window.ol.style.Stroke({color:"#F80",width:3})});r.setStyle(s);e.getSource().addFeature(r)}})(window.__sbg_function_manageDrawing)}function matchDrawSliderButtons(e){$("#draw").on("click",(t=>{var n,i;e.css({bottom:`${$(window).height()-((n=$(t.target).offset())===null||n===void 0?void 0:n.top)-$("#draw").outerHeight()}px`});e.find(".draw-slider-buttons").css({padding:`0 ${(i=$(t.target).offset())===null||i===void 0?void 0:i.left}px`})}));setCSS(`\n            .draw-slider-wrp {\n                transform: translate(-50%, 0);\n                top: auto;\n            }\n\n            .sbgcui_drawslider_sort {\n                position: static;\n                top: auto;\n                width: auto;\n            }\n        `)}class Builder{constructor(e){this.features={};this.points={};this.pointStyles={};this.lines=new CoordsMap;this.regions=new CoordsMap;this.linesMap=new CoordsMap;this.regionsMap=new CoordsMap;this.drawTeam=4;this.maxDrawAttempts=3;this.initCSS();this.initTeam();this.initLayers();const t=this.initButtons(e);this.initFeatures(t);this.initData();this.initMapClick();this.initStates();this.initHelpPopup();this.initRoutePopup();this.initCopyPaste();Object.defineProperty(window,"builder",{value:this})}initCSS(){setCSS(`\n                .builder {\n                    position: relative;\n                    margin-top: 1em;\n                    pointer-events: all;\n                    width: 120px;\n                }\n\n                .builder button {\n                    display: block;\n                    margin-bottom: 0.25em;\n                    width: 100%;\n                }\n\n                .builder button.active {\n                    background: white;\n                    font-weight: bold;\n                    border-radius: 4px;\n                }\n\n                [data-theme="dark"] .builder button.active {\n                    color: buttonface;\n                }\n            `)}initTeam(){const e=$("#self-info__name").attr("style");if(e){const t=e.match(/team\-(\d+)/);if(t){this.ownTeam=parseInt(t[1])}}window.__sbg_variable_TeamColors.get().push({fill:"#FF880030",stroke:"#F80"})}initLayers(){this.addLayer("lines_built","lines");this.addLayer("regions_built","regions");this.addLayer("regions_shared","regions");s.get("lines").getSource().on("addfeature",(e=>{this.addLine(e.feature,this.getLineCoords(e.feature),{mine:false})}));s.get("regions").getSource().on("addfeature",(e=>{this.addRegion(e.feature,this.getRegionCoords(e.feature),{mine:false})}));s.get("lines").getSource().getFeatures().forEach((e=>{this.addLine(e,this.getLineCoords(e),{mine:false})}));s.get("regions").getSource().getFeatures().forEach((e=>{this.addRegion(e,this.getRegionCoords(e),{mine:false})}))}addLayer(e,t){const n=addLayer(e,t);s.set(e,n)}initButtons(e){return $("<div></div>").addClass("builder").appendTo(e)}initFeatures(n){const i={home:false,allLines:true,builder:false,undo:false,clear:false,route:false,copy:false,paste:false,help:true};const o={home:this.setHome,allLines:this.toggleAllLines,builder:this.toggle,undo:this.undo,clear:this.clear,route:this.printRoute,copy:this.copy,paste:this.paste,help:this.showHelp};for(const r of e){this.features[r]=new BuilderFeature({name:r,buttonContainer:n,initialState:i[r],action:o[r],label:t.builder.buttons[r],builder:this})}}initData(){this.data=new BuilderData(this);this.data.load()}initMapClick(){const e=window.__sbg_variable_map.get().getListeners("click")[0];const extendedMapClick=t=>{if(this.features.builder.getState()){this.mapClick(t)}else{e(t)}};window.__sbg_variable_map.get().un("click",e);window.__sbg_variable_map.get().on("click",extendedMapClick)}mapClick(e){window.__sbg_variable_map.get().forEachFeatureAtPixel(e.pixel,(async(e,t)=>{log(`BUILDER click layer: ${t.getProperties().name}`);if(t.getProperties().name!=="points"){return}const n=e;const i=this.getPointCoords(n);this.setPointDrawing(n,true);if(!this.startPoint){log(`BUILDER clicked: start coords: ${JSON.stringify(i)}`);this.startPoint=n;return}const o=n;if(o.getId()===this.startPoint.getId()){return}log(`BUILDER clicked: end coords: ${JSON.stringify(i)}`);const r=await LineData.load([this.startPoint,o],this);const s=this.buildLine(r);this.setPointDrawing(this.startPoint,false);this.setPointDrawing(o,false);if(s){this.startPoint=undefined}}))}getNPoints(){const e=window.__sbg_variable_map.get().getView().getZoom();if(e>10)return 5;if(e>7)return 25;return 50}setPointDrawing(e,t){if(t){this.pointStyles[e.getId()]=e.getStyle();e.setStyle(window.__sbg_variable_FeatureStyles.get().POINT(e.getGeometry().flatCoordinates,this.drawTeam,1,true))}else{e.setStyle(this.pointStyles[e.getId()])}}initStates(){this.toggleAllLines(!this.features.allLines.getState());this.toggle(!this.features.builder.getState());this.data.updateStates()}initHelpPopup(){const e=`\n                <h3>${t.builder.help.title.toString()}</h3>\n                <b>${t.builder.help.buttons.toString()}:</b>\n                <ul>\n                ${Object.values(t.builder.buttons).map((e=>`<li><b>${e.title.toString()}</b> - ${e.description.toString()}</li>`)).join("\n")}\n                </ul>\n                <b>${t.builder.issues.title.toString()}:</b>\n                <ul>\n                ${t.builder.issues.list.map((e=>`<li>${e.toString()}</li>`)).join("\n")}\n                </ul>\n            `;createPopup("help").prepend(e)}initRoutePopup(){const e=$("<textarea></textarea>").on("click",(e=>e.stopPropagation())).on("keydown",(e=>e.stopPropagation()));createPopup("route").prepend(e)}initCopyPaste(){$(document).on("keydown",(e=>{if(e.ctrlKey){switch(e.key){case"c":return this.data.copy(true);case"v":return this.data.paste(true)}}}))}getCoords(e){const t=window.ol.proj.toLonLat(e);return t.map((e=>parseFloat(e.toFixed(6))))}getFlatCoordinates(e){return window.ol.proj.fromLonLat(e)}getArcFlatCoordinates(e){const t=[];for(let n=1;n<e.length;n++){const i=window.turf.greatCircle(e[n-1],e[n],{npoints:this.getNPoints()});t.push(i.geometry.coordinates)}return t.flat().map((e=>this.getFlatCoordinates(e)))}getPointCoords(e){const{flatCoordinates:t}=e.getGeometry();return this.getCoords(t)}getLineCoords(e){const{flatCoordinates:t}=e.getGeometry();const n=this.getCoords([t[0],t[1]]);const i=this.getCoords([t[t.length-2],t[t.length-1]]);return this.createLineCoords(n,i)}getRegionCoords(e){const{flatCoordinates:t}=e.getGeometry();const n=this.getCoords([t[0],t[1]]);const i=this.getCoords([t[t.length*1/3],t[t.length*1/3+1]]);const o=this.getCoords([t[t.length*2/3],t[t.length*2/3+1]]);return this.createRegionCoords(n,i,o)}createLineCoords(...e){const t=e.sort((function(e,t){return e[0]-t[0]||e[1]-t[1]}));return[t[0],t[1]]}createRegionCoords(...e){const t=e.sort((function(e,t){return e[0]-t[0]||e[1]-t[1]}));return[t[0],t[1],t[2],t[0]]}addLine(e,t,{mine:n}){if(![this.ownTeam,this.drawTeam].includes(e.getProperties().team)){return}this.linesMap.create(t[0],[]).push({coords:t[1],mine:n});this.linesMap.create(t[1],[]).push({coords:t[0],mine:n});this.lines.set(t,e);this.checkRegions(t,{mine:n})}addRegion(e,t,{mine:n}){if(![this.ownTeam,this.drawTeam].includes(e.getProperties().team)){return}this.regionsMap.create([t[0],t[1]],[]).push({region:e,mine:n});this.regionsMap.create([t[0],t[2]],[]).push({region:e,mine:n});this.regionsMap.create([t[1],t[2]],[]).push({region:e,mine:n});this.regions.set(t,e)}buildLine({linePoints:e,lineCoords:t},n=0){const i=`line.built.${(new Date).getTime()}`;const o="lines_built";const r=this.lines.get(t);if(r){if(this.features.allLines.getState()||r.getProperties().mine){log(`BUILDER buildLine cancelled, already exists, coords: ${JSON.stringify(t)}`);return}else{log(`BUILDER buildLine duplicated, layer: ${o}, coords: ${JSON.stringify(t)}`)}}else{log(`BUILDER buildLine, layer: ${o}, attempt: ${n}, coords: ${JSON.stringify(t)}`)}const a=this.getArcFlatCoordinates(t);const l=new window.ol.Feature({geometry:new window.ol.geom.LineString(a)});l.setId(i);l.setProperties({team:this.drawTeam,mine:true});l.setStyle(new window.ol.style.Style({stroke:new window.ol.style.Stroke({color:window.__sbg_variable_TeamColors.get()[this.drawTeam].stroke,width:2})}));const c=s.get(o).getSource();const d=c.getFeatures().length;c.addFeature(l);if(c.getFeatures().length===d){n++;log(`BUILDER buildLine failed, attempt: ${n}, coords: ${JSON.stringify(t)}`);if(n>=this.maxDrawAttempts){return}this.buildLine({linePoints:e,lineCoords:t},n);return}this.addLine(l,t,{mine:true});this.data.add({linePoints:e,lineCoords:t});return l}buildRegion(e,t,n=0){const i=`region.built.${(new Date).getTime()}`;const o=t?"regions_shared":"regions_built";const r=this.createRegionCoords(...e);const a=this.regions.get(r);if(a){if(!this.features.allLines.getState()&&!t&&(!a.getProperties().mine||a.getProperties().shared)){log(`BUILDER buildRegion duplicated, layer: ${o}, coords: ${JSON.stringify(r)}`)}else{log(`BUILDER buildRegion cancelled, already exists, coords: ${JSON.stringify(r)}`);return}}else{log(`BUILDER buildRegion, layer: ${o}, coords: ${JSON.stringify(r)}`)}const l=this.getArcFlatCoordinates(r);const c=new window.ol.Feature({geometry:new window.ol.geom.Polygon([l])});c.setId(i);c.setProperties({team:this.drawTeam,mine:true,shared:t});c.setStyle(new window.ol.style.Style({fill:new window.ol.style.Fill({color:window.__sbg_variable_TeamColors.get()[this.drawTeam].fill})}));const d=s.get(o);const u=d.getSource();const g=u.getFeatures().length;u.addFeature(c);if(u.getFeatures().length===g){n++;log(`BUILDER buildRegion failed, attempt: ${n}, coords: ${JSON.stringify(r)}`);if(n>=this.maxDrawAttempts){return}this.buildRegion(e,t,n);return}this.addRegion(c,r,{mine:true});return c}checkRegions(e,{mine:t}){const n=this.linesMap.get(e[0]);const i=this.linesMap.get(e[1]);if(!n||!i)return;for(const o of n){for(const n of i){if(o.coords[0]===n.coords[0]&&o.coords[1]===n.coords[1]){if(t||o.mine||n.mine){const i=!(t&&o.mine&&n.mine);this.buildRegion([...e,o.coords],i)}}}}}async setHome(e){if(e){if(!confirm(t.builder.messages.deleteHome.toString()))return false;delete localStorage.homeCoords}else{if(!confirm(t.builder.messages.setHome.toString()))return false;localStorage.homeCoords=JSON.stringify(window.__sbg_variable_map.get().getView().getCenter())}return true}async toggleAllLines(e){s.get("lines").setVisible(!e);s.get("regions").setVisible(!e);s.get("regions_shared").setVisible(!e&&this.features.builder.getState());return true}async toggle(e){s.get("lines_built").setVisible(!e);s.get("regions_built").setVisible(!e);s.get("regions_shared").setVisible(!e&&this.features.allLines.getState());this.features.builder.setState(!e);this.data.updateStates()}async undo(e){if(!e){return false}const{lineCoords:t}=this.data.pop()||{};if(t){const e=this.lines.get(t);if(!e){log(`undo: line not found, coords: ${JSON.stringify(t)}`);return false}s.get("lines_built").getSource().removeFeature(e);this.lines.deleteMine(t);const n=this.regionsMap.get(t);if(n){n.filter((({mine:e})=>e)).forEach((({region:e})=>{s.get("regions_built").getSource().removeFeature(e);s.get("regions_shared").getSource().removeFeature(e);this.regions.deleteMine(this.getRegionCoords(e))}))}}return false}async clear(e){if(!e){return false}s.get("lines_built").getSource().clear();s.get("regions_built").getSource().clear();s.get("regions_shared").getSource().clear();this.data.clear();this.lines.clearMine();this.regions.clearMine();this.linesMap.clearMine();this.regionsMap.clearMine();this.startPoint=undefined;return false}async printRoute(e){if(!e){return false}const t=this.data.getRoute();$(".route.popup").find("textarea").val(t).end().removeClass("hidden")}async copy(e){return this.data.copy(e)}async paste(e){return this.data.paste(e)}async showHelp(e){$(".help").removeClass("hidden")}}class BuilderFeature{constructor({name:e,action:t,initialState:n,label:i,buttonContainer:o,builder:r}){this.name=e;this.action=t.bind(r);this.button=this.createButton(i,o);this.initState(n)}getState(){return this.state.value}setState(e){this.state.value=e}setButtonState(){this.button.toggleClass("active",this.state.value)}initState(e){const t=this.loadState(e);this.state=new Proxy({value:t},{get:(e,t)=>e[t],set:(e,t,n)=>{const i=this.getStorageKey();localStorage[i]=n?"1":"0";e[t]=n;this.setButtonState();return true}});this.setButtonState()}loadState(e){const t=this.getStorageKey();const n=localStorage[t];return n===undefined||n.length===0?e:n==="1"}getStorageKey(){return`sbg-plus-state-${this.name}`}createButton(e,t){const n=$("<button></button>").html(e.title.toString().toUpperCase()).attr("title",e.description.toString()).appendTo(t);n.on("click",(async()=>{if(await this.action(this.state.value)){this.state.value=!this.state.value}}));return n}}class BuilderData{constructor(e){this.storageKey="builderData";this.builder=e;this.data=[]}add(e){this.data.push(e);this.updateStates();this.save()}pop(){const e=this.data.pop();this.updateStates();this.save();return e}clear(){this.data=[];this.updateStates();this.save()}count(){return this.data.length}updateStates(){const e=this.builder.features.builder.getState();const t=this.data.length>0;this.builder.features.undo.setState(e&&t);this.builder.features.clear.setState(e&&t);this.builder.features.route.setState(e&&t);this.builder.features.copy.setState(e&&t);this.builder.features.paste.setState(e)}save(){localStorage[this.storageKey]=JSON.stringify(BuilderData.pack(this.data));log(`BUILDER saved lines: ${this.data.length}`)}load(){const e=localStorage[this.storageKey];if(e){this.set(e)}}set(e){const t=this.parse(e);if("error"in t){alert(t.error.toString());return}const n=BuilderData.unpack(t.pack);for(const e of n){this.builder.buildLine(e)}}static pack(e){const t=new CoordsMap;const n=[];for(const{lineCoords:i,linePoints:o}of e){n.push(i);o.forEach((e=>{t.set(e.coords,e)}))}return{points:t.getData(),lines:n}}static unpack(e){const t=[];const n=new CoordsMap(e.points);for(const i of e.lines){const e=[n.get(i[0]),n.get(i[1])];const o=new LineData(e,i);t.push(o)}return t}parse(e){let n;try{n=JSON.parse(e)}catch(e){return{error:t.builder.validationErrors.json}}const i=new BuilderDataPackValidator(t.builder.validationErrors);if(!i.validate(n)){return{error:i.getError()}}return{pack:n}}async copy(e){if(!e){return false}await navigator.clipboard.writeText(JSON.stringify(BuilderData.pack(this.data)));alert(t.builder.messages.copied.toString())}async paste(e){if(!e){return false}const n=await navigator.clipboard.readText();if(!n.trim()){alert(t.builder.validationErrors.empty.toString())}this.set(n)}getRoute(){return this.data.map((e=>e.linePoints.map((e=>e.title)).join(" => "))).join("\n")}}class LineData{constructor(e,t){this.linePoints=e;this.lineCoords=t}static async load(e,t){const n=e.map((e=>PointData.resolve(e,t)));const i=await Promise.all(n);const o=t.createLineCoords(i[0].coords,i[1].coords);return new LineData(i,o)}}class PointData{constructor(){}static async resolve(e,t){const n=new PointData;n.guid=e.getId();n.title=await PointData.getPointTitle(n.guid,t.points);n.coords=t.getPointCoords(e);return n}static async getPointTitle(e,t){if(!t[e]){const{response:n}=await window.__sbg_function_apiQuery("point",{guid:e});t[e]=n.data.t}return t[e]}}const l=typeof{};class BuilderDataPackValidator{constructor(e){this.validationErrors=e}validate(e){return this.checkObject(e)&&this.checkObjectProperties(e)&&this.checkPoints(e.points)&&this.checkPointsCoords(e.points)&&this.checkLines(e.lines)&&this.checkLinesCoords(e.lines)}isObject(e,t){if(Object.keys(e).length!==Object.keys(t).length){return false}for(const n in t){const i=t[n];if(!(n in e&&typeof e[n]===i)){return false}}return true}isArray(e,t,n){if(!Array.isArray(e)){return false}if(e.length!==t){return false}for(const t of e){if(typeof t!==n){return false}}return true}checkObject(e){if(typeof e!=="object"){this.validationError=this.validationErrors.object;return false}return true}checkObjectProperties(e){if(!this.isObject(e,{points:"object",lines:"object"})){this.validationError=this.validationErrors.objectProperties;return false}return true}checkPoints(e){if(Object.values(e).filter((e=>!this.isObject(e,{guid:"string",title:"string",coords:"object"}))).length>0){this.validationError=this.validationErrors.pointProperties;return false}return true}checkPointsCoords(e){if(Object.values(e).map((e=>e.coords)).filter((e=>!this.isArray(e,2,"number"))).length>0){this.validationError=this.validationErrors.pointCoords;return false}return true}checkLines(e){if(!Array.isArray(e)||e.filter((e=>!this.isArray(e,2,"object"))).length>0){this.validationError=this.validationErrors.lines;return false}return true}checkLinesCoords(e){if(e.flat().filter((e=>!this.isArray(e,2,"number"))).length>0){this.validationError=this.validationErrors.linesCoords;return false}return true}getError(){return this.validationError}}class CoordsMap{constructor(e={}){this.data=e}stringifyKey(e){return typeof e==="string"?e:e.map((e=>Array.isArray(e)?e.join(","):e)).join(",")}getData(){return this.data}get(e){return this.data[this.stringifyKey(e)]}set(e,t){this.data[this.stringifyKey(e)]=t}create(e,t){if(!this.has(e)){this.set(e,t)}return this.get(e)}has(e){return this.stringifyKey(e)in this.data}forEach(e){for(const t in this.data){e(this.data[t],t)}}deleteMine(e){const t=this.stringifyKey(e);const n=this.data[t];if(n instanceof window.ol.Feature&&n.getProperties().mine){delete this.data[t]}if(Array.isArray(n)){const e=n.filter((e=>!e.mine));if(e.length===0){delete this.data[t]}else{this.data[t]=e}}}clearMine(){Object.keys(this.data).forEach((e=>{this.deleteMine(e)}))}}main()})();
